(()=>{var e={};e.id=44,e.ids=[44],e.modules={5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},42449:e=>{"use strict";e.exports=require("pg")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},30994:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>n.a,__next_app__:()=>c,pages:()=>l,routeModule:()=>p,tree:()=>u});var t=s(70260),a=s(28203),i=s(25155),n=s.n(i),o=s(67292),d={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);s.d(r,d);let u=["",{children:["(pages)",{children:["login",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,61019)),"/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/src/app/(pages)/login/page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,71354)),"/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],l=["/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/src/app/(pages)/login/page.tsx"],c={require:s,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/(pages)/login/page",pathname:"/login",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},79392:(e,r,s)=>{"use strict";s.r(r),s.d(r,{"001ceca995e446d8feebb36954bff66df1af521413":()=>i.m,"401af72ff7f7d55f51261b404620916ec184026e28":()=>c.A,"401c375d175b3bc04c185da96fc99497d2f03fc5ff":()=>l.A,"404d2a60c440802fda175063cb62a4ab50ddfb22da":()=>o.A,"408ca83da2a7494c7a7781ffd9ab611ba56ee51811":()=>u.A,"40f6de09ec2822252f3fdfc0bb278e4ae125d2c60a":()=>a.d,"40f8f2f090ca352e6b95c38277e385fc1dd79b6b94":()=>d.A,"6098242062054845d9c23bff0445dbf4ba7b3e57ee":()=>i.P,"60c448cf360e41d7f8ac8c944614f59edb8e5c9841":()=>p.A,"60d1f6e8477b5a8c6b0fdcae07b94e02c8d4cb1269":()=>f.A,"60e17cb2baeee781bd9da0356c33ad975f46aaf1c0":()=>n.A,"7f5f553b95b32f91fbfa62b02a301ed5755c7b9bb6":()=>t.q});var t=s(18482),a=s(21337),i=s(76109),n=s(71807),o=s(42734),d=s(50679),u=s(18251),l=s(89321),c=s(91278),p=s(49695),f=s(81790)},53542:(e,r,s)=>{"use strict";s.r(r),s.d(r,{"40da4a0fad9adc9907ac30d7fd85b319bdd81f87c9":()=>p});var t=s(21590);s(70376);var a=s(13362),i=s(5486),n=s.n(i);async function o(e,r){return await n().compare(e,r)}var d=s(97792),u=s(18394),l=s(37855),c=s(71082);async function p(e){if(!e||!e.email.trim()&&!e.password.trim())return{success:!1,status:400,msg:"Invalid data"};if(!e.email.trim()||e.email.trim().toLowerCase().length>255||e.email.trim().toLowerCase().length<4||"string"!=typeof e.password)return{success:!1,status:400,msg:"Invalid email"};if(!e.password.trim()||e.password.trim().toLowerCase().length>100||e.password.trim().toLowerCase().length<6||"string"!=typeof e.password)return{success:!1,status:400,msg:"Invalid password"};try{let r=[e.email.trim().toLowerCase()],s=await (0,a.P)(`
            SELECT 
                u.id, 
                u.slug, 
                u.first_name, 
                u.last_name, 
                u.email, 
                u.password, 
                u.created_at, 
                u.avatar, 
                i.id AS avatar_url,
                u.onboarding, 
                u.hireable,
                u.about
            FROM users u
            INNER JOIN images i
                ON i.id = u.avatar
            WHERE email = $1`,r);if(!s||!s.rowCount)return{success:!1,status:400,msg:"A user does not exist with that email"};if(s.rowCount<1)return{success:!1,status:404,msg:"A user does not exist with that email"};if(s.rowCount>1)return{success:!1,status:400,msg:"Multiple users found. Please contact support"};if(!await o(e.password.trim(),s.rows[0].password))return{success:!1,status:403,msg:"Password is incorrect"};let t=(0,u.A)(),i=s.rows[0].id,n=await (0,d.j)(t,i),p=null;n&&(p=n),await (0,l.m)(t,p.expiresAt);let f=s.rows[0],m=await (0,c.A)(s.rows[0].id,!0),g={id:f.id,slug:f.slug,firstName:f.first_name,lastName:f.last_name,email:f.email,tags:[],followersCount:0,followingCount:0,followers:[],followed:[],avatar:1,avatar_url:"/images/public/orange.svg",onboarding:0,hireable:!1,about:"",experience:[]};if(!m.success)return{success:!1,status:500,msg:m.msg};return g=m.user,{success:!0,msg:"Logged in",user:{...g,email:s.rows[0].email},session:n}}catch(e){return{success:!1,status:400,msg:e?`${`${e}`.includes("error: ")?`${e}`.split("error: ")[1].trim():e}`:"A server error occurred"}}}(0,s(99344).D)([p]),(0,t.A)(p,"40da4a0fad9adc9907ac30d7fd85b319bdd81f87c9",null)},77857:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,59607,23)),Promise.resolve().then(s.bind(s,32321))},91009:(e,r,s)=>{Promise.resolve().then(s.t.bind(s,28531,23)),Promise.resolve().then(s.bind(s,37089))},79334:(e,r,s)=>{"use strict";var t=s(58686);s.o(t,"usePathname")&&s.d(r,{usePathname:function(){return t.usePathname}}),s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(r,{useSearchParams:function(){return t.useSearchParams}})},37089:(e,r,s)=>{"use strict";s.d(r,{default:()=>f});var t=s(45512),a=s(61739),i=s.n(a),n=s(79334),o=s(97734),d=s(26248);let u=(0,d.createServerReference)("40da4a0fad9adc9907ac30d7fd85b319bdd81f87c9",d.callServer,void 0,d.findSourceMapURL,"default");var l=s(58009),c=s(92273),p=s(50520);function f(){let e=(0,n.useRouter)(),[r,s]=(0,l.useState)({isError:!1,msg:""}),a=(0,c.wA)();async function d(r){r.preventDefault(),s({isError:!1,msg:""});let{user:t}=await (0,o.q)();if(t){e.push("/"),s({isError:!0,msg:"You're already logged in"});return}let i=new FormData(r.target),n={email:i.get("email")?.toString().toLowerCase().trim(),password:i.get("password")?.toString().toLowerCase().trim()};if(!n||!n.email&&!n.password){s({isError:!0,msg:"Please fill in the form"});return}if(!n.email||n.email.length>255||n.email.length<4||!n.email.includes("@")||!n.email.includes(".")){s({isError:!0,msg:"Please enter a valid email"});return}if(!n.password||n.password.length>255||n.password.length<8){s({isError:!0,msg:"Please enter a stronger password"});return}let d=await u({email:`${n.email}`,password:`${n.password}`});if(!d){s({isError:!0,msg:"An error occurred"});return}if(!1===d.success||!d.user){s({isError:!0,msg:d.msg});return}e.push("/profile"),a((0,p.gV)(d.user))}return(0,t.jsxs)("form",{onSubmit:d,className:i().form,children:[(0,t.jsx)("input",{name:"email",type:"text",placeholder:"Email"}),(0,t.jsx)("input",{name:"password",type:"text",placeholder:"Password"}),(0,t.jsx)("button",{children:"Signup"}),r.isError&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{children:"Error!"}),(0,t.jsxs)("p",{children:[" ",r.msg," "]})]})]})}},61739:e=>{e.exports={form:"loginForm_form__5KrfQ"}},59607:(e,r,s)=>{let{createProxy:t}=s(73439);e.exports=t("/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/node_modules/next/dist/client/app-dir/link.js")},32321:(e,r,s)=>{"use strict";s.d(r,{default:()=>t});let t=(0,s(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/src/app/(pages)/login/LoginForm.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/tahaparacha/Downloads/Coding/Main Projects/seagull/website/src/app/(pages)/login/LoginForm.tsx","default")},61019:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>u});var t=s(62740),a=s(31831),i=s(18482),n=s(32321),o=s(59607),d=s.n(o);async function u(){let{user:e}=await (0,i.q)();return null!==e?(0,a.redirect)("/profile"):(0,t.jsx)("div",{className:"wrapper",children:(0,t.jsxs)("div",{className:"container",children:[(0,t.jsx)("h2",{children:" Welcome back. Login "}),(0,t.jsx)(n.default,{}),(0,t.jsx)(d(),{href:"/signup",children:"Don't have an account? Signup"})]})})}},18482:(e,r,s)=>{"use strict";s.d(r,{q:()=>d});var t=s(88977);s(98063);var a=s(44512),i=s(76301),n=s(21337),o=s(56215);let d=(0,i.cache)(async()=>{let e=await (0,a.UL)(),r=e.get("session")?.value??null;return null===r?{session:null,user:null}:await (0,n.d)(r)});(0,o.D)([d]),(0,t.A)(d,"7f5f553b95b32f91fbfa62b02a301ed5755c7b9bb6",null)},37855:(e,r,s)=>{"use strict";s.d(r,{m:()=>i});var t=s(21590);s(70376);var a=s(42385);async function i(e,r){(await (0,a.UL)()).set("session",e,{httpOnly:!0,sameSite:"lax",secure:!0,expires:r,path:"/"})}(0,s(99344).D)([i]),(0,t.A)(i,"60ec433cda06725b5640b902ce3a3d04b79273dc0a",null)},97792:(e,r,s)=>{"use strict";s.d(r,{j:()=>o});var t=s(21590);s(70376);var a=s(13362),i=s(64230),n=s(57647);async function o(e,r){let s={id:(0,i.tO)((0,n.sc)(new TextEncoder().encode(e))),userId:r,createdAt:new Date(Date.now()),expiresAt:new Date(Date.now()+2592e6)},t=[s.id,s.userId,s.createdAt,s.expiresAt];try{let e=await (0,a.P)("INSERT INTO user_sessions (id, user_id, created_at, expires_at) VALUES ($1, $2, $3, $4)",t);if(console.log(e),!e||!e.rowCount||1!==e.rowCount)throw"Session not created";return s}catch(e){return console.log(e),null}}(0,s(99344).D)([o]),(0,t.A)(o,"6012cc3921ca54aa209a49baab3933c78f1d086c3b",null)},18394:(e,r,s)=>{"use strict";s.d(r,{A:()=>a});var t=s(64230);function a(){let e=new Uint8Array(20);return crypto.getRandomValues(e),(0,t.Kg)(e)}},21337:(e,r,s)=>{"use strict";s.d(r,{d:()=>d});var t=s(88977);s(98063);var a=s(76109),i=s(64397),n=s(8147),o=s(71807);async function d(e){let r=(0,i.tO)((0,n.sc)(new TextEncoder().encode(e))),s=await (0,a.P)(`
        SELECT 
            s.id AS session_id, 
            s.user_id, 
            s.created_at AS session_created_at, 
            s.expires_at,
            u.slug
        FROM user_sessions s
        INNER JOIN users u
            ON u.id = s.user_id 
        WHERE s.id = $1`,[r]);if(!s||0===s.rowCount)return{session:null,user:null};let t=s.rows[0],d=await (0,o.A)(t.slug,!0);if(!d.success||!d.user)return{session:null,user:null};let u={id:t.session_id,userId:t.user_id,createdAt:new Date(t.session_created_at.toISOString()),expiresAt:new Date(t.expires_at.toISOString())},l=new Date(u.expiresAt);return Date.now()>=l.getTime()?(await (0,a.P)("DELETE FROM user_sessions WHERE id = $1",[u.id]),{session:null,user:null}):(Date.now()>=l.getTime()-2592e6&&(u.expiresAt=new Date(Date.now()+2592e6),await (0,a.P)("UPDATE user_sessions SET expires_at = $1 WHERE id = $2",[u.expiresAt,u.id])),{session:u,user:d.user})}(0,s(56215).D)([d]),(0,t.A)(d,"40f6de09ec2822252f3fdfc0bb278e4ae125d2c60a",null)}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[638,246,825,77,635,512,819,436,82,382],()=>s(30994));module.exports=t})();